# 计算机系统漫游

## 信息：位 + 上下文

### 位

- 别名：比特
- 定义：二进制位，取值为0或1
- 应用：组成所有数据类型的基础单位
- 示例：10101010

### 字节

- 定义：8个位组成的单位
- 应用：存储字符、整数、浮点数等数据类型
- 示例：01000001（A的ASCII码）

### 程序存储方式

- 字节序列：程序以字节的方式存储在文件中的

### 文件格式

- 文本文件：只由 ASCII 字符构成的文件
- 二进制文件：非文本文件

### 基本思想

- 系统中所有的信息，都是由一串位（比特）表示的。
区分不同数据对象的唯一方法是我们读取到这些数据对象时的上下文。

- 例如：在不同的上下文中，相同的位序列可以表示不同的数据对象
（如整数、浮点数、字符或机器指令等）。

## 程序被其它程序翻译成不同的格式

### 定义：

- 程序语句都必须被其它程序转换为一系列的低级 机器语言 指令 。
然后这些指令按照一种称为 可执行目标程序 的格式打包，并以二
进制磁盘文件的形式存放起来。

### 过程：

#### 预处阶段（Preprocessor）：处理宏定义、条件编译等指令。

- 工具: **cpp** (C Preprocessor)
- 输入: **.c** 源文件
- 输出: **.i** 预处理后文件

- 主要功能:
  - 处理所有以 **#** 开头的预处理指令
  - 展开宏定义 (**#define**)
  - 包含头文件 (**#include**)
  - 条件编译 (**#if**, **#ifdef**, **#ifndef**)

- 示例命令:
  - 只进行预处理 **cpp hello.c hello.i**
  - 或者使用gcc的-E选项 **gcc -E hello.c -o hello.i**
  - -E 选项：Stop after preprocessing 仅执行预处理阶段，生成预处理文件后停止

#### 编译阶段（Compiler）：将高级语言代码转换为汇编语言代码。

- 工具: **cc1** (C Compiler 1)
- 输入: **.i** 预处理后文件
- 输出: **.s** 汇编代码文件

- 主要功能:
  - 语法和语义分析
  - 生成中间代码
  - 优化代码
  - 生成目标平台的汇编代码

- 示例命令:
  - 只进行编译  **gcc -S hello.i -o hello.s**
  - 或者直接从.c文件开始  **gcc -S hello.c -o hello.s**
  - -S 选项：Stop after compilation 仅执行编译阶段，生成汇编代码后停止

#### 汇编阶段（Assembler）：将汇编语言代码转换为机器语言代码。

- 工具: **as** (Assembler)
- 输入: **.s** 汇编代码文件
- 输出: **.o** 目标文件

- 主要功能:
  - 将汇编代码翻译为机器指令
  - 生成可重定位的目标文件：这意味着链接器可以在后续阶段把它们组合成最终的可执行文件。
  - 创建符号表：符号表记录了变量、函数、标签等的地址信息，供链接器使用。
  - 处理地址引用：处理局部地址（如跳转标签）和外部引用（如调用其他模块的函数）。

- 示例命令:
  - 只进行汇编 **as hello.s -o hello.o**
  - 或者直接从.c文件开始  **gcc -c hello.c -o hello.o**
  - -c 选项：Compile only 仅执行汇编阶段，生成目标文件后停止

#### 链接阶段（Linker）：将多个目标文件链接成一个可执行文件

- 工具: **ld**（或通过 **gcc** 间接调用）
- 输入: 一个或多个 **.o** 目标文件
- 输出: 可执行文件（默认名为 **a.out**，可通过 **-o** 指定）

- 主要功能:
  - 合并多个目标文件的代码段（.text）和数据段（.data）
  - 解析符号引用：将未定义的符号与其他目标文件中定义的符号匹配
  - 处理重定位信息：根据最终内存布局调整地址引用
  - 生成最终的可执行文件，包含入口点（如 **main**）

- 示例命令:
  - 使用链接器直接链接：**ld hello.o -o hello**（需手动指定启动代码）
  - 使用编译器自动链接：**gcc hello.c -o hello**（自动调用链接器并添加启动代码）
 

## 高速缓存

- 定义：高速缓存是介于 CPU 和主存（RAM）之间 的一小块超快存储空间

- 作用：
  - 存储最近或频繁使用的数据和指令
  - 加快 CPU 访问数据的速度
  - 减少访问主存的次数

- 层次结构：
  - 一级缓存（L1 Cache）：直接连接到 CPU，分为指令缓存和数据缓存
  - 二级缓存（L2 Cache）：通常较大，也直接连接到 CPU
  - 三级缓存（L3 Cache）：在多核心处理器中共享，较大
  - 主存（Main Memory）：最大容量，较慢。

- 例子：想象你在厨房做饭，L1 Cache 就像你手边的调料罐，随手就能拿；
主存 RAM 就像冰箱，你得走过去打开才能拿到食材；
硬盘就像超市，你得出门才能买回来。


## 操作系统管理硬件

- 基本功能：
  - 防止硬件被失控的应用程序滥用
  - 向应用程序提供简单一致的硬件资源的抽象接口

- 基本抽象概念：
  - 进程（Process）：
    - 进程是操作系统对一个正在运行的程序的一种抽象。
    - 每个进程都有自己的地址空间、寄存器和栈。

  - 线程（Thread）：
    - 线程是进程内的一个执行单元，共享进程的地址空间和资源。
    - 每个线程有自己的程序计数器、寄存器和栈。
      - 程序计数器（PC）: 记录当前执行的指令地址。
      - 寄存器上线文：保存执行状态，支持线程切换
      - 栈空间（Stack）：存储函数调用和局部变量，线程私有

  - 虚拟内存（Virtual Memory）：
    - 虚拟内存是一种由操作系统提供的内存管理机制，它让每个进程拥有一个独立且连续的虚拟地址空间，即使物理内存不足也能运行大型程序。

    - 主要作用：
      - 扩展内存容量：让程序运行时不受物理内存限制
      - 进程隔离：让每个进程拥有独立空间，提升安全性和稳定性
      - 提升效率：通过局部性原理和缓存机制，减少内存访问延迟

    - 主要依赖：
      - 地址映射机制：通过页表将虚拟地址映射到物理地址
      - 分页徐婷：将内存划分为固定大小的页（Page），并在需要时将页调入或调出物理内存
      - 硬盘上的交换空间（Swap）：当物理内存不足时，部分数据会临时存放在硬盘中

  - 文件（File）：对输入输出设备和普通文件的统一抽象。